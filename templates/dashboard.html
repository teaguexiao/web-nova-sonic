<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Analytics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #0f1419 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            color: #ffffff;
        }

        .dashboard-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .time-filter {
            display: flex;
            gap: 8px;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            background: transparent;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .filter-btn:hover {
            border-color: #4facfe;
            color: #4facfe;
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: transparent;
            color: #ffffff;
        }

        .refresh-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .refresh-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .refresh-btn.loading .refresh-icon {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .logout-btn {
            padding: 10px 20px;
            border: 1px solid rgba(239, 68, 68, 0.5);
            border-radius: 10px;
            background: transparent;
            color: #ef4444;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.1);
        }

        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(79, 172, 254, 0.3);
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            border-radius: 4px 0 0 4px;
        }

        .kpi-card.blue::before { background: linear-gradient(180deg, #4facfe, #00f2fe); }
        .kpi-card.green::before { background: linear-gradient(180deg, #11998e, #38ef7d); }
        .kpi-card.purple::before { background: linear-gradient(180deg, #667eea, #764ba2); }
        .kpi-card.orange::before { background: linear-gradient(180deg, #f093fb, #f5576c); }
        .kpi-card.cyan::before { background: linear-gradient(180deg, #00d2ff, #3a7bd5); }
        .kpi-card.pink::before { background: linear-gradient(180deg, #ff758c, #ff7eb3); }

        .kpi-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .kpi-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            margin-bottom: 8px;
        }

        .kpi-value {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .kpi-card.blue .kpi-value { color: #4facfe; }
        .kpi-card.green .kpi-value { color: #38ef7d; }
        .kpi-card.purple .kpi-value { color: #a78bfa; }
        .kpi-card.orange .kpi-value { color: #f5576c; }
        .kpi-card.cyan .kpi-value { color: #00d2ff; }
        .kpi-card.pink .kpi-value { color: #ff7eb3; }

        .kpi-trend {
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .kpi-trend.up { color: #38ef7d; }
        .kpi-trend.down { color: #ef4444; }
        .kpi-trend.neutral { color: rgba(255, 255, 255, 0.5); }

        /* Chart Grid */
        .chart-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-grid-equal {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
        }

        .chart-card:hover {
            border-color: rgba(79, 172, 254, 0.3);
        }

        .chart-card h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: rgba(255, 255, 255, 0.9);
        }

        .chart-container {
            width: 100%;
            height: 350px;
        }

        .chart-container.small {
            height: 280px;
        }

        .chart-container.heatmap {
            height: 320px;
        }

        /* Full width chart */
        .chart-full {
            grid-column: 1 / -1;
        }

        /* Loading state */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 20, 25, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 3px solid rgba(79, 172, 254, 0.2);
            border-top-color: #4facfe;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-text {
            margin-top: 20px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 16px;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: rgba(255, 255, 255, 0.4);
            font-size: 14px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 30px;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }
            .chart-grid-equal {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            .header-right {
                flex-direction: column;
            }
            .time-filter {
                flex-wrap: wrap;
                justify-content: center;
            }
            .kpi-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .kpi-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Animate numbers */
        @keyframes countUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .kpi-value {
            animation: countUp 0.5s ease-out;
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading Dashboard...</div>
    </div>

    <div class="dashboard-container">
        <header class="header">
            <h1>Login Analytics Dashboard</h1>
            <div class="header-right">
                <div class="time-filter">
                    <button class="filter-btn" data-range="today">Today</button>
                    <button class="filter-btn" data-range="week">This Week</button>
                    <button class="filter-btn" data-range="month">This Month</button>
                    <button class="filter-btn active" data-range="all">All Time</button>
                </div>
                <button class="refresh-btn" id="refreshBtn">
                    <span class="refresh-icon">üîÑ</span> Refresh
                </button>
                <a href="/dashboard/logout" class="logout-btn">Logout</a>
            </div>
        </header>

        <!-- KPI Cards -->
        <div class="kpi-grid">
            <div class="kpi-card blue">
                <div class="kpi-icon">üìä</div>
                <div class="kpi-label">Total Logins</div>
                <div class="kpi-value" id="totalLogins">-</div>
                <div class="kpi-trend neutral" id="totalLoginsTrend">Loading...</div>
            </div>
            <div class="kpi-card green">
                <div class="kpi-icon">üë•</div>
                <div class="kpi-label">Unique Users</div>
                <div class="kpi-value" id="uniqueUsers">-</div>
                <div class="kpi-trend neutral">By AWS Alias</div>
            </div>
            <div class="kpi-card purple">
                <div class="kpi-icon">üè¢</div>
                <div class="kpi-label">Unique Customers</div>
                <div class="kpi-value" id="uniqueCustomers">-</div>
                <div class="kpi-trend neutral">Organizations</div>
            </div>
            <div class="kpi-card orange">
                <div class="kpi-icon">üìà</div>
                <div class="kpi-label">Today's Logins</div>
                <div class="kpi-value" id="todayLogins">-</div>
                <div class="kpi-trend" id="growthRate">-</div>
            </div>
            <div class="kpi-card cyan">
                <div class="kpi-icon">üÜï</div>
                <div class="kpi-label">New Users Today</div>
                <div class="kpi-value" id="newUsersToday">-</div>
                <div class="kpi-trend neutral">First-time visitors</div>
            </div>
            <div class="kpi-card pink">
                <div class="kpi-icon">‚ö°</div>
                <div class="kpi-label">Avg Daily Logins</div>
                <div class="kpi-value" id="avgDailyLogins">-</div>
                <div class="kpi-trend neutral">Per day average</div>
            </div>
        </div>

        <!-- Charts Row 1: Trend + Hourly -->
        <div class="chart-grid">
            <div class="chart-card">
                <h3>üìà Daily Login Trend</h3>
                <div class="chart-container" id="trendChart"></div>
            </div>
            <div class="chart-card">
                <h3>‚è∞ Hourly Distribution</h3>
                <div class="chart-container" id="hourlyChart"></div>
            </div>
        </div>

        <!-- Charts Row 2: Rankings -->
        <div class="chart-grid-equal">
            <div class="chart-card">
                <h3>üèÜ Top 10 Active Users</h3>
                <div class="chart-container small" id="userRankingChart"></div>
            </div>
            <div class="chart-card">
                <h3>üè¢ Top 10 Customers</h3>
                <div class="chart-container small" id="customerRankingChart"></div>
            </div>
        </div>

        <!-- Charts Row 3: Heatmap -->
        <div class="chart-card chart-full">
            <h3>üóìÔ∏è Weekly Activity Heatmap</h3>
            <div class="chart-container heatmap" id="heatmapChart"></div>
        </div>

        <footer class="footer">
            Powered by Teague & Claude Code | Real-time Analytics Dashboard
        </footer>
    </div>

    <script>
        // Global variables
        let currentTimeRange = 'all';
        let charts = {};

        // Initialize ECharts with dark theme
        const darkTheme = {
            backgroundColor: 'transparent',
            textStyle: { color: 'rgba(255, 255, 255, 0.8)' },
            title: { textStyle: { color: '#ffffff' } },
            legend: { textStyle: { color: 'rgba(255, 255, 255, 0.7)' } },
            tooltip: {
                backgroundColor: 'rgba(22, 33, 49, 0.95)',
                borderColor: 'rgba(79, 172, 254, 0.3)',
                textStyle: { color: '#ffffff' }
            }
        };

        // Gradient colors
        const gradients = {
            blue: ['#4facfe', '#00f2fe'],
            green: ['#11998e', '#38ef7d'],
            purple: ['#667eea', '#764ba2'],
            orange: ['#f093fb', '#f5576c'],
            cyan: ['#00d2ff', '#3a7bd5']
        };

        // Initialize charts
        function initCharts() {
            charts.trend = echarts.init(document.getElementById('trendChart'));
            charts.hourly = echarts.init(document.getElementById('hourlyChart'));
            charts.userRanking = echarts.init(document.getElementById('userRankingChart'));
            charts.customerRanking = echarts.init(document.getElementById('customerRankingChart'));
            charts.heatmap = echarts.init(document.getElementById('heatmapChart'));

            // Responsive resize
            window.addEventListener('resize', () => {
                Object.values(charts).forEach(chart => chart.resize());
            });
        }

        // Fetch data and update dashboard
        async function fetchData() {
            const refreshBtn = document.getElementById('refreshBtn');
            refreshBtn.classList.add('loading');

            try {
                const response = await fetch(`/dashboard/stats?time_range=${currentTimeRange}`);
                if (!response.ok) {
                    if (response.status === 401) {
                        window.location.href = '/dashboard/login';
                        return;
                    }
                    throw new Error('Failed to fetch data');
                }
                const data = await response.json();
                updateDashboard(data);
            } catch (error) {
                console.error('Error fetching data:', error);
            } finally {
                refreshBtn.classList.remove('loading');
                document.getElementById('loadingOverlay').style.display = 'none';
            }
        }

        // Animate number count up
        function animateNumber(element, target) {
            const duration = 1000;
            const start = 0;
            const startTime = performance.now();

            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const easeOut = 1 - Math.pow(1 - progress, 3);
                const current = Math.floor(start + (target - start) * easeOut);
                element.textContent = current.toLocaleString();

                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }

            requestAnimationFrame(update);
        }

        // Update dashboard with data
        function updateDashboard(data) {
            // Update KPI cards with animation
            animateNumber(document.getElementById('totalLogins'), data.total_logins);
            animateNumber(document.getElementById('uniqueUsers'), data.unique_users);
            animateNumber(document.getElementById('uniqueCustomers'), data.unique_customers);
            animateNumber(document.getElementById('todayLogins'), data.today_logins);
            animateNumber(document.getElementById('newUsersToday'), data.new_users_today);

            // Calculate average daily logins
            const avgDaily = data.daily_stats.length > 0
                ? Math.round(data.total_logins / data.daily_stats.length)
                : 0;
            animateNumber(document.getElementById('avgDailyLogins'), avgDaily);

            // Growth rate
            const growthEl = document.getElementById('growthRate');
            if (data.growth_rate > 0) {
                growthEl.className = 'kpi-trend up';
                growthEl.innerHTML = `‚Üë ${data.growth_rate}% vs yesterday`;
            } else if (data.growth_rate < 0) {
                growthEl.className = 'kpi-trend down';
                growthEl.innerHTML = `‚Üì ${Math.abs(data.growth_rate)}% vs yesterday`;
            } else {
                growthEl.className = 'kpi-trend neutral';
                growthEl.innerHTML = `‚Üí Same as yesterday`;
            }

            // Update charts
            updateTrendChart(data.daily_stats);
            updateHourlyChart(data.hourly_stats);
            updateUserRankingChart(data.user_ranking);
            updateCustomerRankingChart(data.customer_ranking);
            updateHeatmapChart(data.weekly_heatmap);
        }

        // Trend chart
        function updateTrendChart(dailyStats) {
            const dates = dailyStats.map(d => d.date);
            const counts = dailyStats.map(d => d.count);

            const option = {
                ...darkTheme,
                grid: { left: '3%', right: '4%', bottom: '3%', top: '10%', containLabel: true },
                xAxis: {
                    type: 'category',
                    data: dates,
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.2)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.6)', rotate: 45 }
                },
                yAxis: {
                    type: 'value',
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.2)' } },
                    splitLine: { lineStyle: { color: 'rgba(255,255,255,0.05)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.6)' }
                },
                tooltip: {
                    ...darkTheme.tooltip,
                    trigger: 'axis'
                },
                series: [{
                    data: counts,
                    type: 'line',
                    smooth: true,
                    symbol: 'circle',
                    symbolSize: 8,
                    lineStyle: { width: 3, color: '#4facfe' },
                    itemStyle: { color: '#4facfe' },
                    areaStyle: {
                        color: {
                            type: 'linear',
                            x: 0, y: 0, x2: 0, y2: 1,
                            colorStops: [
                                { offset: 0, color: 'rgba(79, 172, 254, 0.4)' },
                                { offset: 1, color: 'rgba(79, 172, 254, 0.05)' }
                            ]
                        }
                    },
                    animationDuration: 1500,
                    animationEasing: 'cubicOut'
                }]
            };

            charts.trend.setOption(option);
        }

        // Hourly distribution (Polar bar chart)
        function updateHourlyChart(hourlyStats) {
            const hours = Array.from({ length: 24 }, (_, i) => `${i}:00`);
            const maxValue = Math.max(...hourlyStats);

            const option = {
                ...darkTheme,
                polar: { radius: ['20%', '80%'] },
                angleAxis: {
                    type: 'category',
                    data: hours,
                    startAngle: 90,
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.2)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.6)', fontSize: 10 }
                },
                radiusAxis: {
                    type: 'value',
                    axisLine: { show: false },
                    axisLabel: { show: false },
                    splitLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } }
                },
                tooltip: {
                    ...darkTheme.tooltip,
                    formatter: params => `${params.name}<br/>Logins: ${params.value}`
                },
                series: [{
                    type: 'bar',
                    data: hourlyStats.map((val, idx) => ({
                        value: val,
                        itemStyle: {
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 1, y2: 1,
                                colorStops: [
                                    { offset: 0, color: '#667eea' },
                                    { offset: 1, color: '#764ba2' }
                                ]
                            },
                            opacity: 0.3 + (val / maxValue) * 0.7
                        }
                    })),
                    coordinateSystem: 'polar',
                    animationDuration: 1500,
                    animationEasing: 'elasticOut'
                }]
            };

            charts.hourly.setOption(option);
        }

        // User ranking chart
        function updateUserRankingChart(userRanking) {
            const users = userRanking.map(u => u.user).reverse();
            const counts = userRanking.map(u => u.count).reverse();
            const maxCount = Math.max(...counts);

            const option = {
                ...darkTheme,
                grid: { left: '3%', right: '15%', bottom: '3%', top: '3%', containLabel: true },
                xAxis: {
                    type: 'value',
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.2)' } },
                    splitLine: { lineStyle: { color: 'rgba(255,255,255,0.05)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.6)' }
                },
                yAxis: {
                    type: 'category',
                    data: users,
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.2)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.8)' }
                },
                tooltip: { ...darkTheme.tooltip },
                series: [{
                    type: 'bar',
                    data: counts.map((val, idx) => ({
                        value: val,
                        itemStyle: {
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 1, y2: 0,
                                colorStops: [
                                    { offset: 0, color: '#11998e' },
                                    { offset: 1, color: '#38ef7d' }
                                ]
                            },
                            borderRadius: [0, 4, 4, 0]
                        }
                    })),
                    label: {
                        show: true,
                        position: 'right',
                        color: 'rgba(255,255,255,0.8)',
                        formatter: '{c}'
                    },
                    animationDuration: 1500,
                    animationEasing: 'cubicOut'
                }]
            };

            charts.userRanking.setOption(option);
        }

        // Customer ranking chart
        function updateCustomerRankingChart(customerRanking) {
            const customers = customerRanking.map(c => c.customer).reverse();
            const counts = customerRanking.map(c => c.count).reverse();

            const option = {
                ...darkTheme,
                grid: { left: '3%', right: '15%', bottom: '3%', top: '3%', containLabel: true },
                xAxis: {
                    type: 'value',
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.2)' } },
                    splitLine: { lineStyle: { color: 'rgba(255,255,255,0.05)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.6)' }
                },
                yAxis: {
                    type: 'category',
                    data: customers,
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.2)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.8)' }
                },
                tooltip: { ...darkTheme.tooltip },
                series: [{
                    type: 'bar',
                    data: counts.map((val, idx) => ({
                        value: val,
                        itemStyle: {
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 1, y2: 0,
                                colorStops: [
                                    { offset: 0, color: '#f093fb' },
                                    { offset: 1, color: '#f5576c' }
                                ]
                            },
                            borderRadius: [0, 4, 4, 0]
                        }
                    })),
                    label: {
                        show: true,
                        position: 'right',
                        color: 'rgba(255,255,255,0.8)',
                        formatter: '{c}'
                    },
                    animationDuration: 1500,
                    animationEasing: 'cubicOut'
                }]
            };

            charts.customerRanking.setOption(option);
        }

        // Weekly heatmap
        function updateHeatmapChart(weeklyHeatmap) {
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            const hours = Array.from({ length: 24 }, (_, i) => `${i}:00`);

            // Transform data for heatmap
            const data = [];
            let maxVal = 0;
            weeklyHeatmap.forEach((dayData, dayIdx) => {
                dayData.forEach((count, hourIdx) => {
                    data.push([hourIdx, dayIdx, count]);
                    if (count > maxVal) maxVal = count;
                });
            });

            const option = {
                ...darkTheme,
                grid: { left: '10%', right: '10%', bottom: '15%', top: '5%' },
                xAxis: {
                    type: 'category',
                    data: hours,
                    splitArea: { show: true },
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.2)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.6)', interval: 1, rotate: 45 }
                },
                yAxis: {
                    type: 'category',
                    data: days,
                    axisLine: { lineStyle: { color: 'rgba(255,255,255,0.2)' } },
                    axisLabel: { color: 'rgba(255,255,255,0.8)' }
                },
                visualMap: {
                    min: 0,
                    max: maxVal || 1,
                    calculable: true,
                    orient: 'horizontal',
                    left: 'center',
                    bottom: '0%',
                    textStyle: { color: 'rgba(255,255,255,0.7)' },
                    inRange: {
                        color: ['#1a1a2e', '#16213e', '#0f3460', '#4facfe', '#00f2fe']
                    }
                },
                tooltip: {
                    ...darkTheme.tooltip,
                    formatter: params => {
                        const [hour, day, count] = params.data;
                        return `${days[day]} ${hours[hour]}<br/>Logins: ${count}`;
                    }
                },
                series: [{
                    type: 'heatmap',
                    data: data,
                    label: { show: false },
                    emphasis: {
                        itemStyle: { shadowBlur: 10, shadowColor: 'rgba(0, 0, 0, 0.5)' }
                    },
                    animationDuration: 1500
                }]
            };

            charts.heatmap.setOption(option);
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            initCharts();
            fetchData();

            // Time filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentTimeRange = btn.dataset.range;
                    fetchData();
                });
            });

            // Refresh button
            document.getElementById('refreshBtn').addEventListener('click', fetchData);

            // Auto refresh every 60 seconds
            setInterval(fetchData, 60000);
        });
    </script>
</body>
</html>
